---
tags:
  - rust
---
[[Основные понятия в Rust]]
**Крейт (crate)** в Rust — это **базовая единица компиляции и распространения кода**. Это аналог *пакета* в других языках (например, `package` в Java/Go, `gem` в Ruby, `npm package` в JavaScript). Крейт может быть:

1.  **Библиотекой (library crate):** Набор модулей, типов, функций и трейтов, предназначенный для повторного использования в других проектах. Он компилируется в файл с расширением `.rlib`.
2.  **Исполняемым файлом (binary crate):** Программа, которую можно запустить. Компилируется в исполняемый файл (например, `my_program` на Linux/macOS или `my_program.exe` на Windows).

**Ключевые характеристики крейтов:**

1.  **Единица компиляции:** Компилятор Rust (`rustc`) обрабатывает код **одного крейта** за раз. `Cargo` (менеджер пакетов и сборки) управляет компиляцией всех крейтов в проекте и их зависимостями.
2.  **Один корневой модуль:** Каждый крейт имеет одну *точку входа*:
    *   Для **библиотеки:** Файл `src/lib.rs` — это корневой модуль крейта. Он определяет публичное API библиотеки.
    *   Для **исполняемого файла:** Файл `src/main.rs` — это корневой модуль и точка входа в программу. В проекте может быть несколько исполняемых крейтов, их корни обычно лежат в `src/bin/*.rs`.
3.  **Управление видимостью (`pub`):** Крейт определяет границу, внутри которой работает система модулей и ключевое слово `pub`. Элементы (функции, структуры, трейты, модули), помеченные как `pub`, становятся частью публичного API крейта и доступны извне. Внутренние (не `pub`) элементы видны только внутри крейта.
4.  **Зависимости (Dependencies):** Крейт может зависеть от других крейтов (библиотек). Эти зависимости объявляются в файле манифеста `Cargo.toml` проекта. Cargo автоматически скачивает нужные версии зависимых крейтов с [crates.io](https://crates.io/) (или других источников) и связывает их при компиляции.
5.  **Уникальное имя:** Каждый крейт (особенно публикуемый на [crates.io](https://crates.io/)) имеет уникальное имя, по которому на него ссылаются в зависимостях.

**Как это работает на практике с `Cargo`:**

1.  **Создание крейта:**
    ```bash
    cargo new my_library --lib  # Создает крейт-библиотеку с корнем в src/lib.rs
    cargo new my_program        # Создает крейт-исполняемый файл с корнем в src/main.rs
    ```
    Это создаст структуру проекта и файл `Cargo.toml`.

2.  **Файл `Cargo.toml` (Манифест):** Содержит **метаданные** крейта и его **зависимости**.
    ```toml
    [package]
    name = "my_program"     # Уникальное имя крейта
    version = "0.1.0"       # Версия (семантическое версионирование)
    edition = "2021"        # Редакция Rust

    [dependencies]          # Раздел для объявления зависимостей
    serde = "1.0"           # Зависимость от библиотеки `serde` версии 1.0.*
    rand = { version = "0.8", features = ["std"] } # Зависимость с указанием feature
    ```

3.  **Структура проекта (пример для библиотеки):**
    ```
    my_library/
    ├── Cargo.toml          # Манифест крейта
    ├── src/
    │   ├── lib.rs          # Корневой модуль библиотечного крейта (публичное API)
    │   ├── module1.rs      # Дополнительный модуль
    │   └── module2/
    │       ├── mod.rs      # Входная точка для модуля `module2`
    │       └── submodule.rs
    └── tests/              # Интеграционные тесты
    ```

4.  **Использование крейтов в коде:**
    *   Чтобы использовать **внешний крейт** (зависимость), его нужно объявить в корневом файле (`lib.rs`/`main.rs`) или внутри модуля с помощью `use` (после того, как он добавлен в `Cargo.toml`):
        ```rust
        // В src/main.rs или src/lib.rs
        use serde::Serialize; // Использование трейта `Serialize` из крейта `serde`
        use rand::Rng;        // Использование трейта `Rng` из крейта `rand`
        ```
    *   Чтобы использовать **другой локальный модуль внутри своего крейта**, используется ключевое слово `mod` и пути:
        ```rust
        // В src/lib.rs
        mod module1;       // Объявляет и включает модуль `module1` из файла `module1.rs`
        pub mod module2;   // Объявляет, включает и делает публичным модуль `module2`

        pub fn library_function() {
            module1::some_function();
            module2::submodule::another_function();
        }
        ```
        ```rust
        // В src/module1.rs
        pub fn some_function() { ... } // `pub` делает функцию доступной за пределами модуля
        ```

5.  **Публикация:** Крейты-библиотеки можно публиковать на реестре [crates.io](https://crates.io/), чтобы другие разработчики могли легко добавить их как зависимости в свои проекты через `Cargo.toml`.

**Аналогии для понимания:**

1.  **LEGO:**
    *   **Крейт** — это коробка LEGO (например, "Замок" или "Космический корабль").
    *   **Модули** внутри крейта — это пакеты с деталями внутри коробки.
    *   **Зависимости (`Cargo.toml`)** — это дополнительные коробки LEGO (например, "Основание" или "Фигурки"), необходимые для постройки основного набора.
    *   **Cargo** — это инструкция и процесс сборки всех коробок вместе.
    *   **Итоговая программа** — это собранная модель из всех необходимых коробок.

2.  **Книга:**
    *   **Крейт** — это целая книга.
    *   **`Cargo.toml`** — это титульный лист и оглавление книги.
    *   **Модули** — это главы книги.
    *   **Функции/Структуры** — это разделы и абзацы внутри глав.
    *   **`pub`** — выделение жирным шрифтом заголовков глав/разделов, чтобы их можно было легко найти из оглавления (публичное API).
    *   **Зависимости** — это ссылки на другие книги (цитаты, источники), необходимые для понимания текущей.

**Важное отличие от `trait`:**

*   **`trait` (трейт):** Это **ключевое слово языка** и **концепция**, определяющая *поведение* (набор методов), которое могут реализовывать типы. Аналогия: *интерфейс*.
*   **`crate` (крейт):** Это **организационная единица** кода (библиотека или программа). Аналогия: *пакет* или *библиотека*.

**Вывод:** Крейт — это фундаментальная строительная единица проектов Rust. `Cargo` использует крейты и их зависимости, объявленные в `Cargo.toml`, для управления скачиванием, компиляцией и сборкой всего проекта в единое целое. Понимание крейтов и работы с `Cargo` критически важно для эффективной разработки на Rust.
[[популярные крейты Rust]]