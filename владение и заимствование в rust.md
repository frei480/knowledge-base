---
tags:
  - rust
---
–í–ª–∞–¥–µ–Ω–∏–µ (ownership) –∏ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ (borrowing) ‚Äî —ç—Ç–æ **–∫–ª—é—á–µ–≤—ã–µ –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏ Rust**, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏ –±–µ–∑ —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º —ç—Ç—É —Å–∏—Å—Ç–µ–º—É –¥–µ—Ç–∞–ª—å–Ω–æ.

# üìú –¢—Ä–∏ –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ü—Ä–∞–≤–∏–ª–∞ –í–ª–∞–¥–µ–Ω–∏—è
1. **–£ –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –µ—Å—Ç—å —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω –≤–ª–∞–¥–µ–ª–µ—Ü**
   –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏.
   ```rust
   let s = String::from("hello"); // s ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü
   ```

2. **–ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –∑–Ω–∞—á–µ–Ω–∏–µ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è**
   –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `drop` –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.
   ```rust
   {
       let s = String::from("hello"); // —Å–æ–∑–¥–∞–Ω–æ
   } // s –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ -> –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞
   ```

3. **–ü—Ä–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–∏ –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—á–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é, –≤–ª–∞–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è (move)**
   –°—Ç–∞—Ä–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π.
   ```rust
   let s1 = String::from("Rust");
   let s2 = s1; // –≤–ª–∞–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–æ –≤ s2
   // println!("{}", s1); // –û–®–ò–ë–ö–ê! s1 –±–æ–ª—å—à–µ –Ω–µ –≤–ª–∞–¥–µ–µ—Ç –¥–∞–Ω–Ω—ã–º–∏
   ```

# üéØ –ü–æ—á–µ–º—É –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ (move)?
- **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–≤–æ–π–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ** (double free)
- **–ò–∑–±–µ–≥–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è** (shallow copy)
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≤–ª–∞–¥–µ–ª–µ—Ü** –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞

---

# üîÑ –ó–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ (Borrowing)
–ö–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤–ª–∞–¥–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º **—Å—Å—ã–ª–∫—É** (`&`). –ï—Å—Ç—å –¥–≤–∞ —Ç–∏–ø–∞:

## 1. –ù–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ –°—Å—ã–ª–∫–∏ (`&T`)
- **–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ**
- **–î–∞–Ω–Ω—ã–µ –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å** —á–µ—Ä–µ–∑ —ç—Ç–∏ —Å—Å—ã–ª–∫–∏
- –î–µ–π—Å—Ç–≤—É—é—Ç –ø–æ–∫–∞ –µ—Å—Ç—å **—Ç–æ–ª—å–∫–æ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ —Å—Å—ã–ª–∫–∏**

```rust
let s = String::from("hello");
let r1 = &s; // OK
let r2 = &s; // OK
println!("{} and {}", r1, r2); // –†–∞–±–æ—Ç–∞–µ—Ç
```

## 2. –ò–∑–º–µ–Ω—è–µ–º—ã–µ –°—Å—ã–ª–∫–∏ (`&mut T`)
- **–¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∏–∑–º–µ–Ω—è–µ–º–∞—è —Å—Å—ã–ª–∫–∞** –Ω–∞ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
- **–ù–µ–ª—å–∑—è –∏–º–µ—Ç—å –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ —Å—Å—ã–ª–∫–∏** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –∏–∑–º–µ–Ω—è–µ–º–æ–π
- –î–∞–Ω–Ω—ã–µ **–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å**

```rust
let mut s = String::from("hello");
let r1 = &mut s;
r1.push_str(", world!"); // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ

// let r2 = &mut s; // –û–®–ò–ë–ö–ê! –í—Ç–æ—Ä–∞—è –∏–∑–º–µ–Ω—è–µ–º–∞—è —Å—Å—ã–ª–∫–∞
// let r3 = &s;     // –û–®–ò–ë–ö–ê! –ù–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è —Å—Å—ã–ª–∫–∞ –ø—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∏–∑–º–µ–Ω—è–µ–º–æ–π
```

---

# ‚ö†Ô∏è –ö–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ –°–∏—Ç—É–∞—Ü–∏–∏, –ö–æ—Ç–æ—Ä—ã–µ –õ–æ–≤–∏—Ç –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä
## 1. –í–∏—Å—è—á–∏–µ –°—Å—ã–ª–∫–∏ (dangling pointers)
```rust
fn dangle() -> &String {
    let s = String::from("hello");
    &s // –û–®–ò–ë–ö–ê! s —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
} // s –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ -> –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞
```

## 2. –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –î–æ—Å—Ç—É–ø –ù–∞ –ß—Ç–µ–Ω–∏–µ –ò –ó–∞–ø–∏—Å—å
```rust
let mut data = vec![1, 2, 3];
let ref1 = &data[0]; // –ù–µ–∏–∑–º–µ–Ω—è–µ–º–∞—è —Å—Å—ã–ª–∫–∞
data.push(4);        // –û–®–ò–ë–ö–ê! –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∏–∑–º–µ–Ω—è–µ–º—É—é —Å—Å—ã–ª–∫—É
println!("{}", ref1);
```

## 3. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ò–∑–º–µ–Ω—è–µ–º—ã–µ –°—Å—ã–ª–∫–∏
```rust
let mut s = String::new();
let r1 = &mut s;
let r2 = &mut s; // –û–®–ò–ë–ö–ê! –î–≤–µ –∏–∑–º–µ–Ω—è–µ–º—ã–µ —Å—Å—ã–ª–∫–∏
r1.push_str("test");
```

---

# üîë –ö–∞–∫ –≠—Ç–æ –†–∞–±–æ—Ç–∞–µ—Ç –ù–∞ –ü—Ä–∞–∫—Ç–∏–∫–µ
## –ü—Ä–∏–º–µ—Ä –° –§—É–Ω–∫—Ü–∏—è–º–∏
```rust
fn main() {
    let s1 = gives_ownership(); // –í–ª–∞–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    let s2 = takes_and_gives_back(s1); // s1 –ø–µ—Ä–µ–º–µ—â–µ–Ω–æ -> –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ –≤ s2
} // s2 —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è –∑–¥–µ—Å—å

fn gives_ownership() -> String {
    String::from("hello") // –í–ª–∞–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞—Ä—É–∂—É
}

fn takes_and_gives_back(s: String) -> String {
    s // –í–ª–∞–¥–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ
}
```

## –°—Ç—Ä—É–∫—Ç—É—Ä—ã –° –í–ª–∞–¥–µ–Ω–∏–µ–º
```rust
struct Person {
    name: String, // –í–ª–∞–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
}

impl Person {
    fn greet(&self) { // –ù–µ–∏–∑–º–µ–Ω—è–µ–º–æ–µ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
        println!("Hello, {}!", self.name);
    }
    
    fn rename(&mut self, new_name: String) { // –ò–∑–º–µ–Ω—è–µ–º–æ–µ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
        self.name = new_name;
    }
}
```

---

# ‚è≥ –í—Ä–µ–º–µ–Ω–∞ –ñ–∏–∑–Ω–∏ (Lifetimes)
–î–ª—è —Å—Å—ã–ª–æ–∫ –≤ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –Ω—É–∂–Ω—ã –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ (`'a`), —á—Ç–æ–±—ã –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø–æ–Ω–∏–º–∞–ª, –∫–∞–∫ –¥–æ–ª–≥–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ.

```rust
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() { x } else { y }
}
```
- `'a` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–∞—è —Å—Å—ã–ª–∫–∞ –∂–∏–≤–µ—Ç **–Ω–µ –¥–æ–ª—å—à–µ**, —á–µ–º —Å–∞–º—ã–µ –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–µ –∏–∑ –≤—Ö–æ–¥–Ω—ã—Ö —Å—Å—ã–ª–æ–∫

---

# üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –°–∏—Å—Ç–µ–º—ã
1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏**
   - –ù–µ—Ç –≤–∏—Å—è—á–∏—Ö —É–∫–∞–∑–∞—Ç–µ–ª–µ–π
   - –ù–µ—Ç –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö (data races)
   - –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ (–ø—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏)

2. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**
   - –ù–µ—Ç –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ GC
   - –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

3. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –±–µ–∑ —Å—Ç—Ä–∞—Ö–∞**
   - –ü—Ä–∞–≤–∏–ª–∞ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –Ω–∞ –∑–∞–ø–∏—Å—å

---

# üõ†Ô∏è –ö–∞–∫ –†–∞–±–æ—Ç–∞—Ç—å –° –°–∏—Å—Ç–µ–º–æ–π –í–ª–∞–¥–µ–Ω–∏—è?
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ** –∫–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–Ω–æ –≤–ª–∞–¥–µ–Ω–∏–µ
2. **–í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –≤–ª–∞–¥–µ–Ω–∏–µ** —á–µ—Ä–µ–∑ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
3. –î–ª—è —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–≥–æ –≤–ª–∞–¥–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
   - `Rc<T>` –¥–ª—è single-thread
   - `Arc<T>` –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏
4. –î–ª—è –∏–∑–º–µ–Ω—è–µ–º–æ–≥–æ —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:
   - `RefCell<T>` –¥–ª—è single-thread
   - `Mutex<T>` –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏

–ü—Ä–∏–º–µ—Ä —Å `Rc`:
```rust
use std::rc::Rc;

let data = Rc::new(String::from("shared"));
let clone1 = Rc::clone(&data); // –°—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫: 2
let clone2 = Rc::clone(&data); // –°—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫: 3
```

---

# üíé –ò—Ç–æ–≥
–°–∏—Å—Ç–µ–º–∞ –≤–ª–∞–¥–µ–Ω–∏—è Rust ‚Äî —ç—Ç–æ:
- **–ñ–µ—Å—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞** –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- **–ù—É–ª–µ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å** –≤ —Ä–∞–Ω—Ç–∞–π–º–µ
- **–ì–∞—Ä–∞–Ω—Ç–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è** 70% –æ—à–∏–±–æ–∫, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã—Ö –¥–ª—è C/C++

–ü–µ—Ä–≤—ã–µ –Ω–µ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç—ã —Å Rust –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–æ—Å—Ç—ã–º–∏ –∏–∑-–∑–∞ –±–æ—Ä—å–±—ã —Å –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º, –Ω–æ —ç—Ç–æ –æ–∫—É–ø–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–∞–¥–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. –•–æ—Ç–∏—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–ª–∏ –∫–µ–π—Å?