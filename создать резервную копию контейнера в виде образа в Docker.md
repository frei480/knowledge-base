---
tags:
  - docker
---

Чтобы создать резервную копию контейнера в виде образа в Docker, вы можете использовать команду docker commit. Вот пошаговая инструкция:

1. Найдите ID или имя вашего контейнера. Вы можете получить список запущенных контейнеров с помощью команды:

```bash   
docker ps   
```

   Если вам нужны все контейнеры, включая остановленные, используйте:

```bash
docker ps -a   
```

2. Создайте образ из контейнера. Используйте команду docker commit, чтобы создать новый образ из существующего контейнера. Синтаксис команды следующий:

   
```bash
docker commit [OPTIONS] CONTAINER IMAGE_NAME[:TAG]
```

   Например:

```bash
docker commit my_container my_backup_image:latest
```

   Здесь my_container — это имя или ID вашего контейнера, а my_backup_image:latest — это имя и тег для нового образа.

3. Проверьте созданный образ. После выполнения команды вы можете проверить, был ли образ успешно создан, с помощью:

```bash
docker images
```


Эти шаги помогут вам создать резервную копию контейнера в виде образа. После этого вы сможете использовать этот образ для создания новых контейнеров или для хранения резервной копии вашего приложения.

Cоздание образа с помощью docker commit не всегда является надежным способом резервного копирования данных для баз данных, таких как PostgreSQL. Это связано с тем, что данные могут находиться в памяти или не быть полностью записанными на диск в момент создания образа. Вместо этого рекомендуется использовать другие методы для резервного копирования данных PostgreSQL.

Вот несколько подходов для резервного копирования данных PostgreSQL в Docker:

▎1. Использование pg_dump

Это стандартный способ резервного копирования базы данных PostgreSQL. Вы можете использовать команду pg_dump для создания дампа базы данных:

```bash
docker exec -t your_postgres_container pg_dump -U your_username your_database > backup.sql
```


Здесь:

• your_postgres_container — имя или ID вашего контейнера с PostgreSQL.
• your_username — имя пользователя PostgreSQL.
• your_database — имя базы данных, которую вы хотите сохранить.
• backup.sql — файл, в который будет сохранен дамп.

▎2. Использование томов

Если вы используете Docker тома для хранения данных PostgreSQL, вы можете просто создать резервную копию тома. Например, если ваш том называется pgdata, вы можете использовать следующую команду для создания архива:

```bash
docker run --rm --volumes-from your_postgres_container -v $(pwd):/backup busybox tar cvf /backup/pgdata_backup.tar /var/lib/postgresql/data
```


Здесь:

• your_postgres_container — имя вашего контейнера.

• pgdata_backup.tar — имя файла, в который будет сохранена резервная копия данных.

▎3. Использование pg_basebackup

Если вам нужно создать полное резервное копирование всей базы данных, вы можете использовать pg_basebackup. Это требует, чтобы ваш сервер PostgreSQL был настроен для работы в режиме репликации.

```bash
docker exec -t your_postgres_container pg_basebackup -U your_username -D /var/lib/postgresql/data/backup -Ft -z
```
▎Восстановление из резервной копии
Для восстановления из дампа, созданного с помощью pg_dump, используйте команду:
```bash
cat backup.sql | docker exec -i your_postgres_container psql -U your_username -d your_database
```

Для восстановления из архивированного тома или pg_basebackup потребуется развернуть данные в соответствующем каталоге.
Эти методы обеспечивают более надежное резервное копирование и восстановление данных PostgreSQL в Docker-контейнерах.