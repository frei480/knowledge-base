---
tags:
  - docker
  - python
---

пересказ видео https://www.youtube.com/watch?v=tc713anE3UY
Как уменьшить размер Вашего Изображения Python Docker на 80%

00:00 Введение в Docker

• Docker может стать сложным, если не оптимизировать файл Docker.
• Видео покажет, как создать оптимизированный и эффективный образ Docker.
• Пример простого API с одной конечной точкой.

00:39 Настройка Docker

• Для запуска API локально нужен файл Docker.
• Установка зависимостей с помощью Poetry.
• Настройка переменных окружения и запуск приложения FastAPI.

01:34 Создание образа Docker

• Передача переменных окружения как аргументов командам Docker.
• Создание образа Docker занимает 36 секунд.
• Запуск сервера Unicorn внутри контейнера Docker.

02:46 Оптимизация базового образа

• Использование Ubuntu делает образ Docker большим.
• Рассмотрение других базовых образов, таких как Python.
• Python-based образы также могут быть большими.

03:25 Использование Python-based образов

• Python-based образы основаны на Debian.
• Варианты: Bookworm, Slim, Bull's Eye, Buster.
• Официальные образы обновляются чаще и безопаснее.

04:28 Оптимизация файла Docker

• Замена Ubuntu на Python Slim Bookworm.
• Установка Python уже включена в образ.
• Время сборки сокращается до 31 секунды, размер образа уменьшается до 868 МБ.

05:20 Использование тегов

• Использование конкретных тегов для контроля версий.
• Пример с тегом 3.13.3.
• Время сборки остается прежним, но контроль над версией улучшен.

06:07 Оптимизация зависимостей

• Установка только необходимых зависимостей.
• Экономия места и времени сборки.
• Удаление метаданных об истории пакетов.

08:10 Использование другого конструктора

• Переход с Poetry на UV для ускорения сборки.
• Переход с Slim Bookworm на Bookworm Bookworm.
• Время сборки сокращается до 8,7 секунд, но размер образа увеличивается до 1,61 ГБ.

09:31 Многоступенчатая сборка

• Использование многоступенчатой сборки для повышения эффективности.
• Один образ для сборки и установки, другой для запуска веб-сервера.
• Docker справляется с несколькими этапами сборки.

09:55 Многоступенчатая сборка

• Использование многоступенчатой сборки в Docker.
• Установка зависимостей через файл проекта pipe.
• Настройка виртуальной среды и запуск uicorn.

10:53 Оптимизация сборки

• Быстрая сборка за 5,3 секунды.
• Уменьшение размера изображения Docker.
• Экономия на хранении и развертывании.

11:25 Проверка работы

• Запуск сервера и проверка конечной точки.
• Оптимизация файла Docker для копирования только необходимых файлов.

13:19 Безопасность и секретное монтирование

• Использование секретного монтирования для защиты данных.
• Альтернативное решение с использованием хранилища, такого как Hashicorp.

14:57 Запуск от имени пользователя без прав root

• Создание пользователя без прав root для запуска контейнера.
• Ограничение возможностей злоумышленника.

16:15 Заключение и сложности

• Быстрая сборка и маленький размер изображения.
• Сложности работы с Docker и многоступенчатыми сборками.
• Ссылка на репозиторий с файлами Docker и советы по локальной разработке.

