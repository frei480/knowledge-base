---
tags:
  - rust
---
[[–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è –≤ Rust]]
–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ Rust ‚Äî —ç—Ç–æ –æ–¥–Ω–∞ –∏–∑ —Å–∏–ª—å–Ω–µ–π—à–∏—Ö —Å—Ç–æ—Ä–æ–Ω —è–∑—ã–∫–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ **—è–≤–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ç–∏–ø–æ–≤**. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö, Rust –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —Ç–∏–ø–æ–≤ `Result` –∏ `Option`, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –†–∞–∑–±–µ—Ä—ë–º –∫–ª—é—á–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã.

---

# üìå –û—Å–Ω–æ–≤–Ω—ã–µ –¢–∏–ø—ã –î–ª—è –û–±—Ä–∞–±–æ—Ç–∫–∏ –û—à–∏–±–æ–∫
## 1. `Option<T>` ‚Äî –î–ª—è –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ó–Ω–∞—á–µ–Ω–∏–π
```rust
enum Option<T> {
    Some(T),
    None,
}
```
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å (–±–µ–∑ –æ—à–∏–±–∫–∏ –∫–∞–∫ —Ç–∞–∫–æ–≤–æ–π)
- –ü—Ä–∏–º–µ—Ä: –ø–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
```rust
let numbers = vec![1, 2, 3];
let maybe_num = numbers.get(5); // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Option<&i32>
```

## 2. `Result<T, E>` ‚Äî –î–ª—è –û–±—Ä–∞–±–æ—Ç–∫–∏ –û—à–∏–±–æ–∫
```rust
enum Result<T, E> {
    Ok(T),
    Err(E),
}
```
- `T` ‚Äî —Ç–∏–ø —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- `E` ‚Äî —Ç–∏–ø –æ—à–∏–±–∫–∏ (–¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ç—Ä–µ–π—Ç `std::error::Error`)
```rust
use std::fs::File;

let file_result = File::open("config.toml");
// file_result: Result<File, std::io::Error>
```

---

# üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –ú–µ—Ç–æ–¥—ã –†–∞–±–æ—Ç—ã
## 1. –Ø–≤–Ω–∞—è –û–±—Ä–∞–±–æ—Ç–∫–∞ –ß–µ—Ä–µ–∑ `match`
```rust
let file = match File::open("config.toml") {
    Ok(f) => f,
    Err(e) => {
        eprintln!("–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–∞: {}", e);
        return; // –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
    }
};
```

## 2. "–°–∞—Ö–∞—Ä–∫–∏" –î–ª—è –ë—ã—Å—Ç—Ä–æ–π –û–±—Ä–∞–±–æ—Ç–∫–∏
- `unwrap()`: –ü–∞–Ω–∏–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–≤)
  ```rust
  let file = File::open("config.toml").unwrap();
  ```
- `expect()`: –ü–∞–Ω–∏–∫–∞ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
  ```rust
  let file = File::open("config.toml").expect("–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω");
  ```
- `unwrap_or_default()`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  ```rust
  let num: i32 = "123".parse().unwrap_or_default(); // 123
  let num: i32 = "abc".parse().unwrap_or_default(); // 0
  ```

## 3. –ü—Ä–æ–±—Ä–æ—Å –û—à–∏–±–æ–∫ –° `?`
–û–ø–µ—Ä–∞—Ç–æ—Ä `?` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏:
```rust
use std::io::{self, Read};

fn read_config() -> Result<String, io::Error> {
    let mut file = File::open("config.toml")?; // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º Err
    let mut contents = String::new();
    file.read_to_string(&mut contents)?; // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ
    Ok(contents)
}
```

---

# üì¶ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫
## 1. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –û—à–∏–±–æ–∫
```rust
fn parse_config() -> Result<Config, String> {
    let contents = read_config().map_err(|e| format!("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è: {}", e))?;
    contents.parse().map_err(|e| format!("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: {}", e))
}
```

## 2. –¶–µ–ø–æ—á–∫–∏ –í—ã–∑–æ–≤–æ–≤ –° `and_then`
```rust
"123"
    .parse::<i32>()
    .and_then(|n| if n > 0 { Ok(n) } else { Err("–ß–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º".into()) })
    .and_then(|n| calculate(n))
```

---

# üß© –°–æ–∑–¥–∞–Ω–∏–µ –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¢–∏–ø–æ–≤ –û—à–∏–±–æ–∫
## –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ `thiserror` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```rust
use thiserror::Error;

#[derive(Error, Debug)]
enum ConfigError {
    #[error("IO error: {0}")]
    Io(#[from] std::io::Error),
    #[error("Parse error: {0}")]
    Parse(#[from] serde_json::Error),
    #[error("Validation error: {field} {message}")]
    Validation { field: String, message: String },
}
```

## –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é
```rust
use std::fmt;

#[derive(Debug)]
struct MyError {
    details: String,
}

impl std::error::Error for MyError {}

impl fmt::Display for MyError {
    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
        write!(f, "{}", self.details)
    }
}
```

---

# üîÑ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ `Option` –ò `Result`
## –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `Option` –í `Result`
```rust
let maybe_num: Option<i32> = Some(42);
let result: Result<i32, &str> = maybe_num.ok_or("–ó–Ω–∞—á–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç");
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –ß–µ—Ä–µ–∑ `ok_or_else`
```rust
let num = numbers
    .get(5)
    .ok_or_else(|| MyError::new("–ò–Ω–¥–µ–∫—Å –∑–∞ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏"))?;
```

---

# üöÄ Best Practices
1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Result` –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –æ—à–∏–±–∫–æ–π**
2. **–ò–∑–±–µ–≥–∞–π—Ç–µ `unwrap()`/`expect()` –≤ –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–¥–µ**
3. **–î–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `anyhow`**:
   ```rust
   use anyhow::{Context, Result};
   
   fn main() -> Result<()> {
       let data = std::fs::read_to_string("file.txt")
           .context("–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª")?;
       // ...
       Ok(())
   }
   ```
4. **–î–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `thiserror`**
5. **–õ–æ–≥–∏—Ä—É–π—Ç–µ —Ü–µ–ø–æ—á–∫–∏ –æ—à–∏–±–æ–∫**:
   ```rust
   eprintln!("–û—à–∏–±–∫–∞: {:#}", err); // –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
   ```

---

# üåü –ü—Ä–∏–º–µ—Ä: –ü–æ–ª–Ω—ã–π –ü–∞–π–ø–ª–∞–π–Ω –û–±—Ä–∞–±–æ—Ç–∫–∏
```rust
use anyhow::{Context, Result};
use serde::Deserialize;

#[derive(Deserialize)]
struct Config { api_key: String }

fn load_config() -> Result<Config> {
    let path = "config.json";
    let data = std::fs::read_to_string(path)
        .with_context(|| format!("–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å {}", path))?;
    
    serde_json::from_str(&data)
        .with_context(|| format!("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ {}", path))
}

fn main() -> Result<()> {
    let config = load_config()?;
    println!("API Key: {}", config.api_key);
    Ok(())
}
```

---

# üí° –ü–æ—á–µ–º—É –≠—Ç–æ—Ç –ü–æ–¥—Ö–æ–¥ –õ—É—á—à–µ –ò—Å–∫–ª—é—á–µ–Ω–∏–π?
1. **–Ø–≤–Ω–æ—Å—Ç—å** ‚Äî —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Å—Ç–µ–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
4. **–ß—ë—Ç–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—Ç–æ–∫–∞** ‚Äî –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

---

# üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ü–æ–¥—Ö–æ–¥–æ–≤
| –ú–µ—Ç–æ–¥               | –ü–ª—é—Å—ã                          | –ú–∏–Ω—É—Å—ã                 |
|---------------------|--------------------------------|------------------------|
| `match`             | –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å                | –ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–π           |
| `?`                 | –õ–∞–∫–æ–Ω–∏—á–Ω—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π         | –¢—Ä–µ–±—É–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞ Result|
| `unwrap()`          | –ë—ã—Å—Ç—Ä–æ –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–≤          | –ü–∞–Ω–∏–∫–∏ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ      |
| `thiserror`/`anyhow`| –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞     | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |

–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ Rust ‚Äî —ç—Ç–æ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è **—è–≤–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**. –•–æ—Ç—è —Å–Ω–∞—á–∞–ª–∞ –ø–æ–¥—Ö–æ–¥ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –Ω–µ–ø—Ä–∏–≤—ã—á–Ω—ã–º, –æ–Ω –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ–º—É –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–º—É –∫–æ–¥—É. –•–æ—Ç–∏—Ç–µ —É–≥–ª—É–±–∏–º—Å—è –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–µ–π—Å—ã –∏–ª–∏ –Ω—é–∞–Ω—Å—ã?